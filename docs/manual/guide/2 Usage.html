<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2 Usage 1.0</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/1%20Introduction%20to%20the%20Heroku%20Plugin.html"><strong>1</strong><span>Introduction to the Heroku Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/2%20Usage.html"><strong>2</strong><span>Usage</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/3%20Tutorials.html"><strong>3</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/4%20Troubleshooting.html"><strong>4</strong><span>Troubleshooting</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Heroku Integration</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/1%20Introduction%20to%20the%20Heroku%20Plugin.html">&lt;&lt; <strong>1</strong><span>Introduction to the Heroku Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/3%20Tutorials.html"><strong>3</strong><span>Tutorials</span> >></a></div>
                


                <div class="project">
                    <h1>2 Usage - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith</p>

                    <p><strong>Version:</strong> 1.0</p>

                    
                </div>

                

                

<h1 id="2 Usage">2 Usage</h1>
The first step is to install the plugin:<p class="paragraph"/><div class="code"><pre>grails install&#45;plugin heroku</pre></div><p class="paragraph"/><h4>Configuration</h4><p class="paragraph"/>There is currently only one configuration option for the plugin, specified in Config.groovy:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.heroku.datasource. disableTimeoutAutoconfiguration</td><td><code>false</code></td><td>disables auto-configuration of DataSource connection timeout checking if <code>true</code></td></tr></table><p class="paragraph"/><h4>Creating an application</h4><p class="paragraph"/>The general steps for creating a Grails application are (not necessarily in order):
<ul class="star">
<li>create and develop the application like any other application</li>
<li>install the <code>heroku</code> plugin</li>
<li>install the <code>mongodb</code>, <code>redis-gorm</code>, <code>rabbitmq</code>, and/or <code>memcached</code> plugins depending on which Heroku services you'll be using</li>
<li>add the Heroku services you'll be using from the web interface (<a href="http://addons.heroku.com/" target="blank">http://addons.heroku.com/</a>) or with the <code>heroku addons:add</code> command</li>
<li>create a local Git repo and commit your application files to it</li>
<li>create the application on Heroku with the <code>heroku create</code> command</li>
<li>deploy the application to Heroku's servers using <code>git push</code></li>
</ul><p class="paragraph"/>See the tutorial in the next section for a detailed walkthrough of the required and optional steps.<p class="paragraph"/><h4>Using the Spring Security Core plugin</h4><p class="paragraph"/>There are a few things to be aware of when using the spring-security-core plugin with Heroku. One is that as of this writing, there's no support at Heroku for session affinity or clustered sessions. So if you run more than one instance of your application, your authentications will tend to fail since after successfully authenticating you will most likely be redirected to another instance with a new HTTP session without the authentication. Even if this doesn't happen immediately, at some point you're likely to land on another instance and have to log in again. One option you can use to get around this limitation is to use the <a href="http://grails.org/plugin/database-session" target="blank">database-session</a> plugin. This stores session data in the database and trades having a single shared session across all instances for a (hopefully) small increase in database access. The plugin is new and hasn't been extensively tested, so make sure it works for your use cases before using it in an important application.<p class="paragraph"/>Another is a more general problem with plugin dependencies that affects the spring-security-core plugin in Grails 2.0 applications. Due to changes in plugin resolution for 2.0, when the war is built the installed plugins' dependent plugins won't be resolved. So the webxml plugin that the spring-security-core plugin depends on won't be resolved and you'll see IllegalStateExceptions for all requests. This is the same issue that requires that you explicitly declare a dependency on the cloud-support plugin (see the tutorials for examples of this). The workaround is simple; just declare an explicit dependency for all plugins that would otherwise be transitively installed, e.g.<p class="paragraph"/><div class="code"><pre>plugins &#123;
   ...<p class="paragraph"/>   compile ':spring&#45;security&#45;core:1.2.7.2'
   compile ':webxml:1.4.1'
   compile ':heroku:1.0'
   compile ':cloud&#45;support:1.0.8'
&#125;</pre></div><p class="paragraph"/>If you're using 1.3.7 you can omit the webxml and cloud-support dependencies since they'll be resolved, but it doesn't hurt to have them there and will make upgrading to 2.0 easier.<p class="paragraph"/>A third issue has to do with SSL and channel security. Heroku uses F5 BIG-IP load balancers that affect how SSL is managed, so the default behavior of checking if a request is secure or insecure won't work. To address this just add a property in Config.groovy to enable checking for the request header value that their load balancers add:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.secureChannel.useHeaderCheckChannelSecurity = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/>This feature is only available in version 1.2.7.2 and higher of the spring-security-core plugin, so be sure to upgrade if you're using an older version.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/1%20Introduction%20to%20the%20Heroku%20Plugin.html">&lt;&lt; <strong>1</strong><span>Introduction to the Heroku Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/3%20Tutorials.html"><strong>3</strong><span>Tutorials</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>


<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
